let ansi:2 load "ansi";

let LINE_WIDTH 80;

fn repeat(symbol number)
	<<@ as(fn _repeat(number string)
		if < 0 number
			>@fn() _repeat -- number , symbol string;
			fn() string;
	;):2 number []
;

fn count(number numbers)
	<<@ as(fn _count(numbers result)
		if != [] numbers
			fn()
				let result
					if == number head numbers
						++ result
						result
				;
				>@fn() _count tail numbers result;
			;
			fn() result;
	;):2 numbers 0
;

fn format_results(results)
	+ "total: " + str size results + "  "
	+ ansi "green" + "success: " str count 1 results + "  "
	ansi "red" + "failure: " str count 0 results
;

fn group(name tests)
	if != "" name
		fn()
			outln
				+ repeat '=' LINE_WIDTH + "\n"
				+ ansi "bold" name + "\n"
				repeat '-' LINE_WIDTH
		;
		fn();

	let results tests;
	outln
		+ repeat '-' LINE_WIDTH + "\n"
		format_results results

	results
;
