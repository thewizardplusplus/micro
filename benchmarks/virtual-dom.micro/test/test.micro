let group:2 load "std/test/group";
let test:2 load "std/test/test";

let make_node:3 ."make_node" load "../index";
let compare_nodes:4 ."compare_nodes" load "../index";
let assert_equality:3 load "../utilities/assert_equality";
let format_differences:1 load "../utilities/format/format_differences";

group "compare_nodes()" fn()
  ,test "should create a node when there's no old node at same place" fn()
    let new_node make_node "input" {} [];
    let difference compare_nodes nil new_node 5 ,"section","form"[];
    let expected
      #"path" ,"section","form"[]
      #"action" "create"
      #"parameters" ,new_node[]
    {};
    assert_equality difference ,expected[] fn(differences)
      format_differences differences
    ;
  ;

  ,test "should remove a node when there's no new node at same place" fn()
    let old_node make_node "input" {} [];
    let difference compare_nodes old_node nil 5 ,"section","form"[];
    let expected
      #"path" ,"section","form"[]
      #"action" "remove"
      #"parameters" ,5[]
    {};
    assert_equality difference ,expected[] fn(differences)
      format_differences differences
    ;
  ;

  ,test "should replace a node when there's a different object at same place" fn()
    let old_node make_node "input" {} [];
    let new_node make_node "textarea" {} [];
    let difference compare_nodes old_node new_node 5 ,"section","form"[];
    let expected
      #"path" ,"section","form"[]
      #"action" "replace"
      #"parameters" ,5,new_node[]
    {};
    assert_equality difference ,expected[] fn(differences)
      format_differences differences
    ;
  ;
[];
